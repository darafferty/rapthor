ARG BASE_NAME=rapthor-base
ARG BASE_TAG=latest
ARG VERSION=0.0.0

FROM $BASE_NAME:$BASE_TAG

# Install Rapthor
COPY . /tmp/rapthor

RUN echo "BASE_NAME=$BASE_NAME"
RUN echo "BASE_TAG=$BASE_TAG"
RUN echo "VERSION=$VERSION"

RUN python3 -m setuptools_scm
RUN SETUPTOOLS_SCM_PRETEND_VERSION=${VERSION} python3 -m setuptools_scm

RUN SETUPTOOLS_SCM_PRETEND_VERSION=${VERSION} \
    python3 -m pip install --no-cache-dir --upgrade /tmp/rapthor && \
        rm -rf /tmp/rapthor
