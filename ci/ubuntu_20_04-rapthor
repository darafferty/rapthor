ARG BASE_NAME=rapthor-base
ARG BASE_TAG=latest

FROM $BASE_NAME:$BASE_TAG

ARG RAPTHOR_VERSION=0.0.0

# RUN echo "BASE_NAME=$BASE_NAME"
# RUN echo "BASE_TAG=$BASE_TAG"
# RUN echo "RAPTHOR_VERSION=$RAPTHOR_VERSION"
# RUN pip install --upgrade setuptools_scm setuptools

# Install Rapthor
COPY . /tmp/rapthor

# RUN cd /tmp/rapthor && python3 -m setuptools_scm
# RUN cd /tmp/rapthor && SETUPTOOLS_SCM_PRETEND_VERSION=${RAPTHOR_VERSION} python3 -m setuptools_scm

RUN SETUPTOOLS_SCM_PRETEND_VERSION=${RAPTHOR_VERSION} \
    python3 -m pip install --no-cache-dir --upgrade /tmp/rapthor && \
        rm -rf /tmp/rapthor
