default:
  image: ubuntu:20.04
  before_script:
    - apt-get update && apt-get install -y g++ cmake libfftw3-dev liblapacke-dev python3 python3-pip

# Avoid getting stuck on requested user input, i.e. avoid 
# https://git.astron.nl/RD/idg/-/jobs/37678#L767
variables:
  DEBIAN_FRONTEND: "noninteractive"

clang-format:
  script: 
    - pip3 install clang-format==9.0.0
    - export PATH=/home/gitlab-runner/.local/bin:$PATH
    - ./scripts/run-clang-format.sh

idg-release:
  script:
    - mkdir build
    - cd build
    - cmake .. -DBUILD_WITH_TESTS=On
    - make
    - make install
    - export LD_LIBRARY_PATH=$(pwd)/lib:$LD_LIBRARY_PATH
    - ctest --verbose

idg-debug:
  script:
    - mkdir build
    - cd build
    - cmake .. -DBUILD_WITH_TESTS=On -DCMAKE_BUILD_TYPE=Debug
    - make
    - make install
    - export LD_LIBRARY_PATH=$(pwd)/lib:$LD_LIBRARY_PATH
    - ctest --verbose
